"use strict";class t{constructor(t){this.blob=t,this.view=new DataView(this.blob),this.offset=0,this.t=new TextDecoder}i(){return this.offset}size(){return this.blob.byteLength}seek(t){this.offset=t}h(t){const s=this.blob.slice(this.offset,this.offset+t);return this.offset+=t,s}o(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}u(){const t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}l(){const t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t}_(){const t=[];for(;;){const s=this.o();if(!s)break;t.push(s)}const s=new Uint8Array(t);return this.t.decode(s)}}class s{constructor(){this.A=[],this.size=0,this.p=new TextEncoder}j(t){this.A.push(t),this.size+=t.byteLength}m(t){this.j(new Uint8Array([t]).buffer)}U(t){this.j(new Uint32Array([t]).buffer)}k(t){this.j(new Uint32Array(t).buffer)}O(t){this.j(new Float32Array([t]).buffer)}S(t){const s=this.p.encode(t);this.j(s),this.m(0)}v(){const t=new Uint8Array(this.size);let s=0;for(const n of this.A)t.set(new Uint8Array(n),s),s+=n.byteLength;return t.buffer}}function n(t,s=4){const n=t%s;return 0==n?0:s-n}class i{constructor(t){this.count=t.u(),this.offset=t.u()}I(t){t.k([this.count,this.offset])}}class h{constructor(t){const s=t.u(),n=t.u();if(1094993440!=s||4!=n)throw new Error("Invalid file header");this.N=new i(t),this.D=new i(t),this.J=new i(t),this.names=new i(t),this.L=t.u(),this.M=Array.from({length:9},(s=>t.u()))}I(t){t.k([1094993440,4]),this.N.I(t),this.D.I(t),this.J.I(t),this.names.I(t),t.U(this.L),t.k(this.M)}}class r{constructor(t){this.offset=t.u(),this.flags=t.u(),this.count=t.u(),t.u()}I(t){t.k([this.offset,this.flags,this.count,0])}}class o{constructor(t){this.text=null,this.key=t.u(),this.T=t.u()}I(t){t.k([this.key,this.T])}}class e{constructor(t){this.text=null,this.key=t.u(),this.T=t.u(),this.B=new r(t),this.F=t.u(),this.V=t.u(),this.W=t.u(),this.flags=t.u()}I(t){t.k([this.key,this.T]),this.B.I(t),t.k([this.F,this.V,this.W,this.flags])}}class c{constructor(t){this.q=t.u(),this.start=t.l(),this.duration=t.l(),t.u()}I(t){t.U(this.q),t.O(this.start),t.O(this.duration),t.U(0)}}class a{constructor(t){this.C=new r(t),this.G=new r(t)}I(t){this.C.I(t),this.G.I(t)}}class u{constructor(t,s,n){this.messages=t,this.H=s,this.K=n}I(t){this.messages.forEach((s=>s.I(t))),this.H.forEach((s=>s.I(t))),this.K.forEach((s=>s.forEach((s=>s.I(t)))))}}class d{constructor(t){this.P=t.u(),this.R=t.u(),this.offset=t.u(),this.size=t.u(),this.X=t.u()}I(t){t.k([this.P,this.R,this.offset,this.size,this.X])}}function w(t,s,n){return Array.from({length:n},(n=>new t(s)))}function l(t,s,n){const i=document.createElement("a"),h=new Blob([s],{type:n});i.href=window.URL.createObjectURL(h),i.download=t,i.click()}window.onload=()=>{const i=document.getElementById("tojson-in");document.getElementById("tojson-btn").onclick=async()=>{if(!i.files||!i.files.length)return;const s=i.files[0].name.replace(".stringlookup",".json"),n=await async function(s){try{const n=await s.arrayBuffer(),i=new t(n),e=(new h(i),i.i()),c=new r(i),u=new r(i);i.seek(e+u.offset);const d=new t(i.h(u.count));i.seek(e+c.offset);const l=w(a,i,c.count),_=w(o,i,l[0].C.count);_.forEach((t=>{d.seek(t.T),t.text=d._()}));const f=_.map((t=>[t.key,t.text])),y=new Map(f);return JSON.stringify(Object.fromEntries(y),null,4)}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(i.files[0]);s&&n&&l(s,n,"application/json")};const _=document.getElementById("tobin-orig"),f=document.getElementById("tobin-json");document.getElementById("tobin-btn").onclick=async()=>{if(!_.files||!_.files.length)return;if(!f.files||!f.files.length)return;const i=await async function(i,l){try{const _=await l.text(),f=JSON.parse(_),y=new Map(Object.entries(f)),b=await i.arrayBuffer(),A=new t(b),p=new h(A),g=A.i(),j=new r(A),m=new r(A);A.i(),j.offset,j.offset=A.i()-g,A.seek(g+m.offset);const U=new t(A.h(m.count)),k=A.i()-g,O=p.N.offset-A.i();A.seek(p.N.offset);const S=new d(A);S.offset,S.offset=g;const v=A.h(A.size()-A.i());A.seek(g+j.offset);const E=Array.from({length:j.count},(t=>new a(A))),I=E.map((t=>{const s=w(o,A,t.C.count),n=w(e,A,t.G.count),i=n.map((t=>w(c,A,t.B.count)));return s.forEach((t=>{U.seek(t.T),t.text=U._()})),n.forEach((t=>{U.seek(t.T),t.text=U._()})),new u(s,n,i)}));[...I[0].messages].forEach((t=>{t.text=y.get(t.key.toString())??t.text}));const N=new s;[...I[0].messages].sort(((t,s)=>t.T-s.T)).forEach((t=>{t.T=N.size,N.S(t.text)})),[...I[0].H].sort(((t,s)=>t.T-s.T)).forEach((t=>{t.T=N.size,N.S(t.text)})),I.slice(1).forEach((t=>{[...t.messages].sort(((t,s)=>t.T-s.T)).forEach((t=>{t.T=N.size,N.S(t.text)}))}));const x=N.v();A.i(),m.offset,m.offset=A.i()-g,m.count=x.byteLength;const D=m.offset+m.count,J=n(g+D,16),L=D+J-(k+O);p.N.offset+=L,p.D.offset+=L,p.J.offset+=L,p.names.offset+=L,p.L+=L,S.size=m.offset+m.count;const M=new s;return p.I(M),j.I(M),m.I(M),E.forEach((t=>t.I(M))),I.forEach((t=>t.I(M))),M.j(x),M.j(new Uint8Array(J)),S.I(M),M.j(v),M.v()}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(_.files[0],f.files[0]);i&&l("NEW_"+_.files[0].name,i,"application/octet-stream")}};

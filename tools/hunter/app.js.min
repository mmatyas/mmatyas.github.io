"use strict";class t{constructor(t){this.blob=t,this.view=new DataView(this.blob),this.offset=0,this.t=new TextDecoder}i(){return this.offset}size(){return this.blob.byteLength}seek(t){this.offset=t}o(t){const s=this.blob.slice(this.offset,this.offset+t);return this.offset+=t,s}h(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}u(){const t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}l(){const t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t}_(){const t=[];for(;;){const s=this.h();if(!s)break;t.push(s)}const s=new Uint8Array(t);return this.t.decode(s)}}class s{constructor(){this.p=[],this.size=0,this.A=new TextEncoder}v(t){this.p.push(t),this.size+=t.byteLength}I(t){this.v(new Uint8Array([t]).buffer)}U(t){this.v(new Uint32Array([t]).buffer)}j(t){this.v(new Uint32Array(t).buffer)}m(t){this.v(new Float32Array([t]).buffer)}k(t){const s=this.A.encode(t);this.v(s),this.I(0)}O(){const t=new Uint8Array(this.size);let s=0;for(const n of this.p)t.set(new Uint8Array(n),s),s+=n.byteLength;return t.buffer}}function n(t,s=4){const n=t%s;return 0==n?0:s-n}class i{constructor(t){this.count=t.u(),this.offset=t.u()}S(t){t.j([this.count,this.offset])}}class r{constructor(t){const s=t.u(),r=t.u();if(1094993440!=s||4!=r)throw new Error("Invalid file header");this.N=new i(t),this.D=new i(t),this.J=new i(t),this.names=new i(t),this.L=t.u(),this.M=Array.from({length:5},(s=>t.u())),this.T=function(t){const s=t._(),i=n(t.i());return t.o(i),s}(t)}S(t){t.j([1094993440,4]),this.N.S(t),this.D.S(t),this.J.S(t),this.names.S(t),t.U(this.L),t.j(this.M),function(t,s){s.k(t);const i=n(s.size);s.v(new Uint8Array(i).buffer)}(this.T,t)}}class o{constructor(t){this.offset=t.u(),this.flags=t.u(),this.count=t.u(),t.u()}S(t){t.j([this.offset,this.flags,this.count,0])}}class h{constructor(t){this.text=null,this.key=t.u(),this.B=t.u()}S(t){t.j([this.key,this.B])}}class e{constructor(t){this.text=null,this.key=t.u(),this.B=t.u(),this.F=new o(t),this.V=t.u(),this.W=t.u(),this.q=t.u(),this.flags=t.u()}S(t){t.j([this.key,this.B]),this.F.S(t),t.j([this.V,this.W,this.q,this.flags])}}class c{constructor(t){this.C=t.u(),this.start=t.l(),this.duration=t.l(),t.u()}S(t){t.U(this.C),t.m(this.start),t.m(this.duration),t.U(0)}}class a{constructor(t){this.G=new o(t),this.H=new o(t)}S(t){this.G.S(t),this.H.S(t)}}class d{constructor(t,s,n){this.messages=t,this.K=s,this.P=n}S(t){this.messages.forEach((s=>s.S(t))),this.K.forEach((s=>s.S(t))),this.P.forEach((s=>s.forEach((s=>s.S(t)))))}}class w{constructor(t){this.R=t.u(),this.X=t.u(),this.offset=t.u(),this.size=t.u(),this.Y=t.u()}S(t){t.j([this.R,this.X,this.offset,this.size,this.Y])}}function u(t,s,n){return Array.from({length:n},(n=>new t(s)))}function l(t,s,n){const i=document.createElement("a"),r=new Blob([s],{type:n});i.href=window.URL.createObjectURL(r),i.download=t,i.click()}window.onload=()=>{const i=document.getElementById("tojson-in");document.getElementById("tojson-btn").onclick=async()=>{if(!i.files||!i.files.length)return;const s=i.files[0].name.replace(".stringlookup",".json"),n=await async function(s){try{const n=await s.arrayBuffer(),i=new t(n),e=(new r(i),i.i()),c=new o(i),d=new o(i);i.seek(e+d.offset);const w=new t(i.o(d.count));i.seek(e+c.offset);const l=u(a,i,c.count),f=u(h,i,l[0].G.count);f.forEach((t=>{w.seek(t.B),t.text=w._()}));const _=f.map((t=>[t.key,t.text])),y=new Map(_);return JSON.stringify(Object.fromEntries(y),null,4)}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(i.files[0]);s&&n&&l(s,n,"application/json")};const f=document.getElementById("tobin-orig"),_=document.getElementById("tobin-json");document.getElementById("tobin-btn").onclick=async()=>{if(!f.files||!f.files.length)return;if(!_.files||!_.files.length)return;const i=await async function(i,l){try{const f=await l.text(),_=JSON.parse(f),y=new Map(Object.entries(_)),b=await i.arrayBuffer(),g=new t(b),p=new r(g),A=g.i(),v=new o(g),E=new o(g);if(g.i()!=A+v.offset)throw new Error("Invalid language header definitions");g.seek(A+E.offset);const I=new t(g.o(E.count)),U=g.i(),j=n(g.i()-A,16);if(g.o(j),g.i()!=p.N.offset)throw new Error("Invalid padding size after the instance");const m=new w(g);if(m.offset!=A)throw new Error("Invalid instance position");if(m.size!=U-A)throw new Error("Invalid instance size");const k=g.o(g.size()-g.i());g.seek(A+v.offset);const O=Array.from({length:v.count},(t=>new a(g))),S=O.map((t=>{const s=u(h,g,t.G.count),n=u(e,g,t.H.count),i=n.map((t=>u(c,g,t.F.count)));return s.forEach((t=>{I.seek(t.B),t.text=I._()})),n.forEach((t=>{I.seek(t.B),t.text=I._()})),new d(s,n,i)}));if(g.i()!=A+E.offset)throw new Error("Invalid language definitions");[...S[0].messages].forEach((t=>{t.text=y.get(t.key.toString())??t.text}));const z=new s;[...S[0].messages].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=z.size,z.k(t.text)})),[...S[0].K].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=z.size,z.k(t.text)})),S.slice(1).forEach((t=>{[...t.messages].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=z.size,z.k(t.text)}))}));const N=z.O(),x=E.offset+E.count,D=n(x,16);E.count=N.byteLength;const J=E.offset+E.count,L=n(x,16),M=J+L-(x+D);p.N.offset+=M,p.D.offset+=M,p.J.offset+=M,p.names.offset+=M,p.L+=M,m.size=J;const T=new s;return p.S(T),v.S(T),E.S(T),O.forEach((t=>t.S(T))),S.forEach((t=>t.S(T))),T.v(N),T.v(new Uint8Array(L)),m.S(T),T.v(k),T.O()}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(f.files[0],_.files[0]);i&&l("NEW_"+f.files[0].name,i,"application/octet-stream")}};

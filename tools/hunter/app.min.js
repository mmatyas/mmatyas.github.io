"use strict";class t{constructor(t){this.blob=t,this.view=new DataView(this.blob),this.offset=0,this.t=new TextDecoder}i(){return this.offset}size(){return this.blob.byteLength}seek(t){this.offset=t}o(t){const s=this.blob.slice(this.offset,this.offset+t);return this.offset+=t,s}h(){const t=this.view.getUint8(this.offset);return this.offset+=1,t}u(){const t=this.view.getUint32(this.offset,!0);return this.offset+=4,t}l(){const t=this.view.getFloat32(this.offset,!0);return this.offset+=4,t}_(){const t=[];for(;;){const s=this.h();if(!s)break;t.push(s)}const s=new Uint8Array(t);return this.t.decode(s)}}class s{constructor(){this.A=[],this.size=0,this.p=new TextEncoder}U(t){this.A.push(t),this.size+=t.byteLength}j(t){this.U(new Uint8Array([t]).buffer)}m(t){this.U(new Uint32Array([t]).buffer)}v(t){this.U(new Uint32Array(t).buffer)}I(t){this.U(new Float32Array([t]).buffer)}k(t){const s=this.p.encode(t);this.U(s),this.j(0)}O(){const t=new Uint8Array(this.size);let s=0;for(const n of this.A)t.set(new Uint8Array(n),s),s+=n.byteLength;return t.buffer}}function n(t,s=4){const n=t%s;return 0==n?0:s-n}class i{constructor(t){this.count=t.u(),this.offset=t.u()}S(t){t.v([this.count,this.offset])}}class r{constructor(t){const s=t.u(),r=t.u();if(1094993440!=s||4!=r)throw new Error("Invalid file header");this.N=new i(t),this.D=new i(t),this.J=new i(t),this.names=new i(t),this.L=t.u(),this.M=Array.from({length:5},(s=>t.u())),this.T=function(t){const s=t._(),i=n(t.i());return t.o(i),s}(t)}S(t){t.v([1094993440,4]),this.N.S(t),this.D.S(t),this.J.S(t),this.names.S(t),t.m(this.L),t.v(this.M),function(t,s){s.k(t);const i=n(s.size);s.U(new Uint8Array(i).buffer)}(this.T,t)}}class o{constructor(t){this.offset=t.u(),this.flags=t.u(),this.count=t.u(),t.u()}S(t){t.v([this.offset,this.flags,this.count,0])}}class h{constructor(t){this.text=null,this.key=t.u(),this.B=t.u()}S(t){t.v([this.key,this.B])}}class e{constructor(t){this.text=null,this.key=t.u(),this.B=t.u(),this.F=new o(t),this.V=t.u(),this.W=t.u(),this.q=t.u(),this.flags=t.u()}S(t){t.v([this.key,this.B]),this.F.S(t),t.v([this.V,this.W,this.q,this.flags])}}class c{constructor(t){this.C=t.u(),this.start=t.l(),this.duration=t.l(),t.u()}S(t){t.m(this.C),t.I(this.start),t.I(this.duration),t.m(0)}}class a{constructor(t){this.G=new o(t),this.H=new o(t)}S(t){this.G.S(t),this.H.S(t)}}class u{constructor(t,s,n){this.messages=t,this.K=s,this.P=n}S(t){this.messages.forEach((s=>s.S(t))),this.K.forEach((s=>s.S(t))),this.P.forEach((s=>s.forEach((s=>s.S(t)))))}}class w{constructor(t){this.R=t.u(),this.X=t.u(),this.offset=t.u(),this.size=t.u(),this.Y=t.u()}S(t){t.v([this.R,this.X,this.offset,this.size,this.Y])}}function d(t,s,n){return Array.from({length:n},(n=>new t(s)))}function l(t,s,n){const i=document.createElement("a"),r=new Blob([s],{type:n});i.href=window.URL.createObjectURL(r),i.download=t,i.click()}window.onload=()=>{const i=document.getElementById("tojson-in");document.getElementById("tojson-btn").onclick=async()=>{if(!i.files||!i.files.length)return;const s=i.files[0].name.replace(".stringlookup",".json"),n=await async function(s){try{const n=await s.arrayBuffer(),i=new t(n),e=(new r(i),i.i()),c=new o(i),u=new o(i);i.seek(e+u.offset);const w=new t(i.o(u.count));i.seek(e+c.offset);const l=d(a,i,c.count),f=d(h,i,l[0].G.count);f.forEach((t=>{w.seek(t.B),t.text=w._()}));const _=f.map((t=>[t.key,t.text])),y=new Map(_);return JSON.stringify(Object.fromEntries(y),null,4)}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(i.files[0]);s&&n&&l(s,n,"application/json")};const f=document.getElementById("tobin-orig"),_=document.getElementById("tobin-json");document.getElementById("tobin-btn").onclick=async()=>{if(!f.files||!f.files.length)return;if(!_.files||!_.files.length)return;const i=await async function(i,l){try{const f=await l.text(),_=JSON.parse(f),y=new Map(Object.entries(_)),b=await i.arrayBuffer(),A=new t(b),g=new r(A),p=A.i(),U=new o(A),j=new o(A);if(A.i()!=p+U.offset)throw new Error("Invalid language header definitions");A.seek(p+j.offset);const m=new t(A.o(j.count)),v=A.i(),E=A.u();A.seek(g.N.offset);const I=new w(A);if(I.offset!=p)throw new Error("Invalid instance position");if(I.size!=v-p)throw new Error("Invalid instance size");const k=A.o(A.size()-A.i());A.seek(p+U.offset);const O=Array.from({length:U.count},(t=>new a(A))),S=O.map((t=>{const s=d(h,A,t.G.count),n=d(e,A,t.H.count),i=n.map((t=>d(c,A,t.F.count)));return s.forEach((t=>{m.seek(t.B),t.text=m._()})),n.forEach((t=>{m.seek(t.B),t.text=m._()})),new u(s,n,i)}));if(A.i()!=p+j.offset)throw new Error("Invalid language definitions");[...S[0].messages].forEach((t=>{t.text=y.get(t.key.toString())??t.text}));const N=new s;[...S[0].messages].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=N.size,N.k(t.text)})),[...S[0].K].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=N.size,N.k(t.text)})),S.slice(1).forEach((t=>{[...t.messages].sort(((t,s)=>t.B-s.B)).forEach((t=>{t.B=N.size,N.k(t.text)}))}));const x=N.O(),z=j.offset+j.count+4,D=n(z,8);j.count=x.byteLength;const J=j.offset+j.count+4,L=n(z,8),M=J+L-(z+D);g.N.offset+=M,g.D.offset+=M,g.J.offset+=M,g.names.offset+=M,g.L+=M,I.size=j.offset+j.count;const T=new s;return g.S(T),U.S(T),j.S(T),O.forEach((t=>t.S(T))),S.forEach((t=>t.S(T))),T.U(x),T.m(E),T.U(new Uint8Array(L)),I.S(T),T.U(k),T.O()}catch(t){alert("Invalid StringLookup file!\n"+t.message)}return null}(f.files[0],_.files[0]);i&&l("NEW_"+f.files[0].name,i,"application/octet-stream")}};

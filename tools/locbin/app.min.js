function e(e){let t=!1;const n=[];for(;!t;){let r=127&e;(e>>=7)?r+=128:t=!0,n.push(r)}return new Uint8Array(n)}function t(t,n){const r=n.encode(t),o=e(r.length),s=new Uint8Array(o.length+r.length);return s.set(o,0),s.set(r,o.length),s}function n(e,n,r){const o=t(e,r),s=t(n,r),c=new Uint8Array(2+o.length+s.length);return c[0]=10,c.set(o,1),c[1+o.length]=18,c.set(s,2+o.length),c}function r(e,t,n){const r=document.createElement("a"),o=new Blob([e],{type:n});r.href=window.URL.createObjectURL(o),r.download=t,r.click()}function o(t){const o=new FileReader;o.onload=()=>{try{const s=JSON.parse(o.result),c=function(t){const r=new TextEncoder,o=[];for(const[s,c]of t){const t=n(s,c,r),i=e(t.length),l=new Uint8Array(1+i.length+t.length);l[0]=10,l.set(i,1),l.set(t,1+i.length),o.push(l)}return o}(new Map(Object.entries(s))),i=function(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}(c);r(i,t.name.replace(".json",".locbin"),"application/octet-stream")}catch(e){alert("Hibás JSON fájl!\n"+e.message)}},o.readAsText(t)}class s{constructor(e){this.blob=e,this.view=new DataView(this.blob),this.offset=0,this.decoder=new TextDecoder}read_blob(e){const t=this.blob.slice(this.offset,this.offset+e);return this.offset+=e,t}read_u8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}read_control(e){if(this.read_u8()!=e)throw new Error("Hiányzó vezérlőbájt")}read_varint(){let e=0,t=0;for(;e<32;){const n=this.read_u8();if(t|=(127&n)<<e,e+=7,!(128&n))return t}throw new Error("Hibás hosszérték")}read_str(){const e=this.read_varint(),t=this.read_blob(e);return this.decoder.decode(t)}}function c(e){reader=new s(e),reader.read_control(10);const t=reader.read_str();reader.read_control(18);return[t,reader.read_str()]}function i(e){return e.read_control(10),data_len=e.read_varint(),data=e.read_blob(data_len),c(data)}window.onload=()=>{const e=document.getElementById("in-locbin");document.getElementById("to-json").onclick=()=>{e.files&&e.files.length>0&&o(e.files[0])};const t=document.getElementById("in-json");document.getElementById("to-locbin").onclick=()=>{t.files&&t.files.length>0&&function(e){const t=new FileReader;t.onload=()=>{try{const n=t.result.byteLength,o=new s(t.result),c=new Map;for(;o.offset<n;){const[e,t]=i(o);c.set(e,t)}r(JSON.stringify(Object.fromEntries(c),null,4),e.name.replace(".locbin",".json"),"application/json")}catch(e){alert("Hibás LOCBIN fájl!\n"+e.message)}},t.readAsArrayBuffer(e)}(t.files[0])}};

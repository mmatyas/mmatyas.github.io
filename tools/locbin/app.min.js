function e(e){let t=!1;const n=[];for(;!t;){let r=127&e;(e>>=7)?r+=128:t=!0,n.push(r)}return new Uint8Array(n)}function t(t,n){const r=n.encode(t),o=e(r.length),s=new Uint8Array(o.length+r.length);return s.set(o,0),s.set(r,o.length),s}function n(e,n,r){const o=t(e,r),s=t(n,r),a=new Uint8Array(2+o.length+s.length);return a[0]=10,a.set(o,1),a[1+o.length]=18,a.set(s,2+o.length),a}async function r(t){try{const r=await t.text(t),o=JSON.parse(r),s=function(t){const r=new TextEncoder,o=[];for(const[s,a]of t){const t=n(s,a,r),i=e(t.length),c=new Uint8Array(1+i.length+t.length);c[0]=10,c.set(i,1),c.set(t,1+i.length),o.push(c)}return o}(new Map(Object.entries(o))),a=function(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}(s);return[t.name.replace(".json",".locbin"),a]}catch(e){alert(t.name+"\nHibás JSON fájl!\n"+e.message)}return[null,null]}class o{constructor(e){this.blob=e,this.view=new DataView(this.blob),this.offset=0,this.decoder=new TextDecoder}read_blob(e){const t=this.blob.slice(this.offset,this.offset+e);return this.offset+=e,t}read_u8(){const e=this.view.getUint8(this.offset);return this.offset+=1,e}read_control(e){if(this.read_u8()!=e)throw new Error("Hiányzó vezérlőbájt")}read_varint(){let e=0,t=0;for(;e<32;){const n=this.read_u8();if(t|=(127&n)<<e,e+=7,!(128&n))return t}throw new Error("Hibás hosszérték")}read_str(){const e=this.read_varint(),t=this.read_blob(e);return this.decoder.decode(t)}}function s(e){reader=new o(e),reader.read_control(10);const t=reader.read_str();reader.read_control(18);return[t,reader.read_str()]}function a(e){return e.read_control(10),data_len=e.read_varint(),data=e.read_blob(data_len),s(data)}async function i(e){try{const t=await e.arrayBuffer(e),n=new o(t),r=new Map;for(;n.offset<t.byteLength;){const[e,t]=a(n);r.set(e,t)}const s=JSON.stringify(Object.fromEntries(r),null,4);return[e.name.replace(".locbin",".json"),s]}catch(t){alert(e.name+"\nHibás LOCBIN fájl!\n"+t.message)}return[null,null]}function c(e,t,n){const r=document.createElement("a"),o=new Blob([t],{type:n});r.href=window.URL.createObjectURL(o),r.download=e,r.click()}async function l(e,t,n){const r=new JSZip;for(const n of e){const[e,o]=await t(n);e&&o&&r.file(e,o)}c(n,await r.generateAsync({type:"uint8array"}),"application/octet-stream")}window.onload=()=>{const e=document.getElementById("in-json");document.getElementById("to-locbin").onclick=async()=>{if(e.files&&e.files.length)if(1!=e.files.length)await l(e.files,r,"locbin_fajlok.zip");else{const[t,n]=await r(e.files[0]);t&&n&&c(t,n,"application/octet-stream")}};const t=document.getElementById("in-locbin");document.getElementById("to-json").onclick=async()=>{if(t.files&&t.files.length)if(1!=t.files.length)await l(t.files,i,"json_fajlok.zip");else{const[e,n]=await i(t.files[0]);e&&n&&c(e,n,"application/json")}}};
